<!-- include header -->
<%- include ('include/sidebar') %>
  <!-- /include header -->


  <!-- Content Wrapper. Contains page content -->
    <div class="content-wrapper bg-color py-5">
        <section class="content">
        <div class="container d-flex justify-content-between">
            <!-- SEARCH FORM -->
            <form class="form-inline">
            <div class="form-group has-search">
                <span class="fa fa-search form-control-feedback"></span>
                <input type="text" class="form-control " placeholder="Search">
            </div>
            </form>
            <a href="/add_audio" class="btn" style="border-radius: 5px; background-color: #3CB179; color: white;">Add
            New Audio</a>
        </div>
        <div class="container mt-5">
            <div class="row d-flex justify-content-between">
            <% audios.forEach(function(audio) { %>
            <div class="col-lg-3 musicall">
                <div class="music_card" style="background:url('images/Rectangle 33.png') no-repeat 70%;">
                <div class="sound-icon-center">
                    <img src="images/icons8_audio_96px_2-1.png" alt="sound"/>
                </div>
                <span style="margin-left: 80%;" class="fa-stack mt-3">
                    <i class="fa fa-circle fa-stack-2x" style="color: #A5E0FF"></i>
                    <a data-toggle="modal" data-target="#deleteuser" id="del-id" data-id="<%= audio._id %>" href=""><i class="fa fa-trash fa-stack-1x"></i></a>
                </span>
                <div class="audio-player" style="margin-top: 62%;">
                    <audio id="audio">
                        <source src="uploads/<%= audio.audio %>" type="audio/mpeg">
                    </audio>
                    <div class="controls">
                        <button class="player-button">
                            <i class="fa fa-play" id="audioBtn"></i>
                        </button>
                        <input style="accent-color: #A5E0FF" type="range" class="timelineaudio" max="100" value="0">
                    </div>
                </div>
                </div>
                
                <div>
                <label class="mt-3 mb-2 font-weight-bold"><%= audio.title %></label>
                <label class="mt-3 mb-2 font-weight-bold text-info textshit" ><%= audio.duration %></label>
                </div>
            </div>
            <% }) %>
            
            </div>
        </div>


        </section>
    </div>

  </div>
  <!-- ./wrapper -->
  <!-- success modal -->
  <% if (message != ''){ %>
    <div class="modal fade py-3" id="successModal">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-body">
                    <i class="fa-solid fa-circle-check mr-2 text-success"></i>
                    <%= message %>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                </div>
            </div>
        </div>
    </div>
    <% } %>
        <!-- end success modal -->

         <!-- delete user -->
  <div class="modal fade" id="deleteuser" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
    <div class="modal-dialog" role="document">
    <div class="modal-content rounded text-center p-3">
      <div class="col-lg-12 text-center">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
      </button>
        <img src="images/delete.png" alt="blockuser" class="img-fluid mt-5" />
      </div>
        <div class="text-center d-flex flex-row mt-5">
            <h5 class="modal-title w-100" id="exampleModalLongTitle">Are you sure you want to Delete this Audio?</h5>
        </div>
        <div class="col-lg-12 d-flex justify-content-center mt-5 mb-5">
            <button type="button" class="btn btn-block w-50 m-1 close" data-dismiss="modal" aria-label="Close" style="border-radius: 15px; color:white; background: #017EBE;">No</button>
            <a href="" type="button" id="delete" class="btn btn-block w-50 m-1" style="border-radius: 15px; color:white; background: #FF3F3F;">Yes, Delete</a>
        </div>
    </div>
    </div>
  </div>

        <!-- ./wrapper -->
    
  </body>
  <script type="text/javascript">
    $(document).ready(function () {
        // is open by default
        $('#successModal').modal('show');

        //audio
        let audio = $('#audio')
        let playState = 'play';

        console.log("d", audio.duration);

        // if(playIconContainer){

            $('.player-button').on('click', (event) => {
                console.log("play");
                if(playState === 'play') {
                    audio[0].play();

                    playState = 'pause';
                } else {
                    audio[0].pause();
                    audio[0].onpause = function() {
                        audio[0].currentTime = 0;
                    };
                    
                    playState = 'play';
                }
            });
        // }

        $('#deleteuser').on('show.bs.modal', function(event){
            var button = $(event.relatedTarget) // Button that triggered the modal
            var deleteID = button.attr('data-id');
            console.log('deleteID: ', deleteID);
            var modal = $(this)
            modal.find('#delete').attr('href', `/delete?audioID=${deleteID}`);
        })

    });
</script>

  </html>